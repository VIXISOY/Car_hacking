# ICSim Signal Detection via CAN Log Analysis

## Project Overview

This project is aimed at identifying the precise CAN bus packets responsible for generating a specific signal within the **ICSim** simulator. The approach uses a Python script to analyze a `candump` log file and iteratively narrows down the packets responsible for the signal by employing binary search.

The script:

-   Takes a path to a CAN bus log generated by `candump` that contains the signal you're interested in.
-   Uses `canplayer` to replay the log until the visual signal change is detected in ICSim.
-   Applies a dichotomy (binary search) to progressively reduce the log file size until it finds the exact packets responsible for the signal.
-   Outputs the packet(s) that caused the signal.

## Requirements

### Software Dependencies:

-   **ICSim** (Instrument Cluster Simulator)
-   **can-utils** (for `candump`, `canplayer`, `cangen`)
-   Python >= 3.10

### Python Libraries:

Ensure the following Python libraries are installed before running the script:

`pip install python-can` 

## Setup and Usage

### Step 1: Generate CAN Traffic

Before running the Python script, you'll need to generate CAN traffic and log it:

1.  **Start ICSim** and ensure it is running in the foreground.
    
    `./icsim vcan0` 
    
    Optionally, you can run `controls`:

    `./controls vcan0` 
    
2.  **Generate traffic** using `cangen` on the CAN bus.
   
    `cangen vcan0` 
    
3.  **Log the CAN traffic** using `candump`, and stop the logging when you observe the signal youâ€™re looking for.
   
    `candump vcan0 > signal_log.log` 
    
    -   Make sure to save the log immediately after the signal appears.
    -   The `signal_log.log` should be your `candump` log file that contains the desired signal.

### Step 2: Configure the Python Script

-   Edit the Python script to point to your generated CAN log file (`signal_log.log`):
   
    `log_file_path = "/path/to/your/signal_log.log"` 
    

### Step 3: Run the Python Script

1.  Ensure that **ICSim** is in the foreground and locked on top of other windows, as the script will replay the log and watch for signal changes visually.
    
2.  Run the Python script:
  
    `python3 detect_signal.py` 
    
    The script will:
    
    -   Replay the log file using `canplayer`.
    -   Continuously split the log file in half, replaying sections of the log to isolate the packets responsible for the signal.
3.  Once the script finishes, it will output the exact packets responsible for the signal.
    

### Example Output

After running the script, the terminal will display the packets that caused the signal, similar to the following:

`Change detected with line: 
(1544106680.228086) can0 67E#01C65274D19FAC6D
` 

### Step 4: Analyze the Results

Use the identified packets for further analysis, modifications, or debugging in ICSim.
You can send it with `cansend`

----------

## Troubleshooting

-   **Script instantly stopping**: Make sure ICSim is running in the foreground, as the script interacts with the visual elements.
-   **No signal detected**: Ensure that the CAN log file contains the correct traffic and that the signal is clearly visible.
-  **Inacurate gueses**:  You can/should tweak screenshots intervals or threshold at the start of the file. It might depend on your specs. You could also put the number of lines to keep higher, as it is when the "slow and precise" scan starts
